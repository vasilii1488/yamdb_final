![workflow](https://github.com/vasilii1488/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

# Проект спринта 10: YaMDb (Yet another Movie Database)
Стек технологий: Python 3, Django, REST API
  
### Алгоритм регистрации пользователей:  
  
1. Пользователь отправляет POST-запрос на добавление нового пользователя с параметрами email и username на эндпоинт /api/v1/auth/signup/.  
2. YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email.  
3. Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен).  
4. При желании пользователь отправляет PATCH-запрос на эндпоинт /api/v1/users/me/ и заполняет поля в своём профайле (описание полей — в документации).  
  
### Пользовательские роли:  
  
- **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.  
- **Аутентифицированный пользователь (user)** — может, как и Аноним, читать всё, дополнительно он может публиковать отзывы и ставить оценку произведениям (фильмам/книгам/песенкам), может комментировать чужие отзывы; может редактировать и удалять свои отзывы и комментарии. Эта роль присваивается по умолчанию каждому новому пользователю.  
- **Модератор (moderator)** — те же права, что и у Аутентифицированного пользователя плюс право удалять любые отзывы и комментарии.  
- **Администратор (admin)** — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.  
- **Суперюзер Django** — обладет правами администратора (admin)  
  
### Аутентификация:  
  
используется аутентификация с использованием JWT-токенов  
  

### Установка
**Шаг 1. Проверьте установлен ли у вас Docker**
Прежде, чем приступать к работе, необходимо знать, что Docker установлен. Для этого достаточно ввести:
```sh
docker -v
```
Или скачайте _Docker Desktop_ для _Mac или Windows_. Docker Compose будет установлен автоматически. В _Linux_ убедитесь, что у вас установлена последняя версия Compose. Также вы можете воспользоваться официальной инструкцией.

**Шаг 2. Клонируйте репозиторий себе на компьютер**
Введите команду:
```git clone https://github.com/vasilii1488/infra_sp2.git```

**Шаг 3. Создайте в клонированной директории файл .env**
Пример:
```
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД
```
Измените файл settings.py, чтобы значения загружались из переменных окружения:
```
DATABASES = {
    'default': {
        'ENGINE': os.getenv('DB_ENGINE'),
        'NAME': os.getenv('DB_NAME'),
        'USER': os.getenv('POSTGRES_USER'),
        'PASSWORD': os.getenv('POSTGRES_PASSWORD'),
        'HOST': os.getenv('DB_HOST'),
        'PORT': os.getenv('DB_PORT')
    }
} 
```
**Шаг 4. Запуск docker-compose**
Для запуска необходимо выполнить из директории с проектом команду:

```docker-compose up -d```

**Шаг 5. База данных**
Создаем и применяем миграции:

```docker-compose exec web python manage.py makemigrations --noinput```

```docker-compose exec web python manage.py migrate --noinput```

*Шаг 6. Подгружаем статику*
Выполните команду:

```docker-compose exec web python manage.py collectstatic --no-input ```

**Другие команды**
Создание суперпользователя:
```docker-compose exec web python manage.py createsuperuser```

Остановить работу всех контейнеров можно командой:
```docker-compose down```

Для пересборки и запуска контейнеров воспользуйтесь командой:
```docker-compose up -d --build ```

Мониторинг запущенных контейнеров:
```docker stats```

Останавливаем и удаляем контейнеры, сети, тома и образы:
```docker-compose down -v```

**Ссылки для проверки**

```http://51.250.103.1/admin```
```http://51.250.103.1/redoc```


### Автор Василий Голев